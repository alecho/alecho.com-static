<!DOCTYPE html>
<html class="font-sans text-base antialiased">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>alecho.com</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;127.0.0.1:1111&#x2F;app.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@500&family=Heebo:wght@700&display=swap"
      rel="stylesheet"
    />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <script
      src="https://kit.fontawesome.com/c756a4a629.js"
      crossorigin="anonymous"
    ></script>
    <script
      async
      type="text/javascript"
      src="http:&#x2F;&#x2F;127.0.0.1:1111&#x2F;app.js"
    ></script>
  </head>
  <body class="min-h-screen bg-theme-light dark:bg-theme-dark">
    <div class="relative">
      <div
        class="relative shadow bg-theme-dark dark:bg-theme"
      >
        <div class="px-4 mx-auto max-w-7xl sm:px-6">
          <div
            class="flex items-center justify-between py-4 md:justify-start md:space-x-10"
          >
            <div class="flex flex-1 w-0">
              <a
                href="/"
                class="inline-flex w-6 h-6 mr-3 text-white text-opacity-75 hover:text-opacity-100 transition-all ease-in-out duration-150"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                  class="w-6 h-6"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
                  />
                </svg>
              </a>
            </div>
            <div class="-my-2 -mr-2 md:hidden">
              <button
                type="button"
                class="inline-flex items-center justify-center p-2 text-theme-light dark:text-theme-dark rounded-md hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:bg-gray-100 focus:text-gray-500 transition duration-150 ease-in-out"
              ></button>
            </div>
            <nav class="hidden md:flex space-x-10">
              <a
                href="/blog"
                class="inline-flex items-center text-base font-bold text-theme-light dark:text-theme-dark space-x-2 leading-6 text-opacity-75 hover:text-opacity-100 transition ease-in-out duration-150"
              >
                Blog
              </a>
              <a
                href="#"
                class="text-base font-bold text-theme-light dark:text-theme-dark leading-6 text-opacity-75 hover:text-opacity-100 transition ease-in-out duration-150"
              >
                Contact
              </a>
              <a
                href="#"
                class="text-base font-bold text-theme-light dark:text-theme-dark leading-6 text-opacity-75 hover:text-opacity-100 transition ease-in-out duration-150"
              >
                Résumé
              </a>
              <a
                href="#"
                class="inline-flex items-center text-base font-bold uppercase text-theme-light hover:text-opacity-75 dark:text-theme-dark space-x-2 leading-6 transition ease-in-out duration-150"
              >
                More
              </a>
            </nav>
            <div
              class="items-center justify-end hidden md:flex space-x-8 md:flex-1 lg:w-0"
            >
              <a
                href="https://github.com/alecho"
                target="_blank"
                class="w-6 h-6 mr-3 text-theme-light hover:text-opacity-75 transition-all ease-in-out duration-150"
              >
                <svg viewBox="0 0 24 24" fill="currentColor">
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M12 2C6.477 2 2 6.463 2 11.97c0 4.404 2.865 8.14 6.839 9.458.5.092.682-.216.682-.48 0-.236-.008-.864-.013-1.695-2.782.602-3.369-1.337-3.369-1.337-.454-1.151-1.11-1.458-1.11-1.458-.908-.618.069-.606.069-.606 1.003.07 1.531 1.027 1.531 1.027.892 1.524 2.341 1.084 2.91.828.092-.643.35-1.083.636-1.332-2.22-.251-4.555-1.107-4.555-4.927 0-1.088.39-1.979 1.029-2.675-.103-.252-.446-1.266.098-2.638 0 0 .84-.268 2.75 1.022A9.606 9.606 0 0112 6.82c.85.004 1.705.114 2.504.336 1.909-1.29 2.747-1.022 2.747-1.022.546 1.372.202 2.386.1 2.638.64.696 1.028 1.587 1.028 2.675 0 3.83-2.339 4.673-4.566 4.92.359.307.678.915.678 1.846 0 1.332-.012 2.407-.012 2.734 0 .267.18.577.688.48C19.137 20.107 22 16.373 22 11.969 22 6.463 17.522 2 12 2z"
                  ></path>
                </svg>
              </a>
            </div>
          </div>
        </div>
      </div>

      <!--
        Mobile menu, show/hide based on mobile menu state.

        Entering: "duration-200 ease-out"
          From: "opacity-0 scale-95"
          To: "opacity-100 scale-100"
        Leaving: "duration-100 ease-in"
          From: "opacity-100 scale-100"
          To: "opacity-0 scale-95"
      -->
      <div
        class="absolute inset-x-0 top-0 z-10 p-2 transition transform origin-top-right md:hidden"
      >
        <div class="rounded-lg shadow-lg">
          <div class="bg-white rounded-lg shadow-xs divide-y-2 divide-gray-50">
            <div class="px-5 pt-5 pb-6 space-y-6">
              <div class="flex items-center justify-between">
                <div>
                  <img
                    class="w-auto h-8"
                    src=""
                    alt="Workflow"
                  />
                </div>
                <div class="-mr-2">
                  <button
                    type="button"
                    class="inline-flex items-center justify-center p-2 text-gray-400 rounded-md hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:bg-gray-100 focus:text-gray-500 transition duration-150 ease-in-out"
                  >
                    <svg
                      class="w-6 h-6"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M6 18L18 6M6 6l12 12"
                      />
                    </svg>
                  </button>
                </div>
              </div>
              <div>
                <nav class="grid row-gap-8">
                  <a
                    href="#"
                    class="flex items-center p-3 -m-3 space-x-3 rounded-md hover:bg-gray-50 transition ease-in-out duration-150"
                  >
                    <svg
                      class="flex-shrink-0 w-6 h-6 text-indigo-600"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
                      />
                    </svg>
                    <div class="text-base font-medium text-gray-900 leading-6">
                      Analytics
                    </div>
                  </a>
                  <a
                    href="#"
                    class="flex items-center p-3 -m-3 space-x-3 rounded-md hover:bg-gray-50 transition ease-in-out duration-150"
                  >
                    <svg
                      class="flex-shrink-0 w-6 h-6 text-indigo-600"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122"
                      />
                    </svg>
                    <div class="text-base font-medium text-gray-900 leading-6">
                      Engagement
                    </div>
                  </a>
                  <a
                    href="#"
                    class="flex items-center p-3 -m-3 space-x-3 rounded-md hover:bg-gray-50 transition ease-in-out duration-150"
                  >
                    <svg
                      class="flex-shrink-0 w-6 h-6 text-indigo-600"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"
                      />
                    </svg>
                    <div class="text-base font-medium text-gray-900 leading-6">
                      Security
                    </div>
                  </a>
                  <a
                    href="#"
                    class="flex items-center p-3 -m-3 space-x-3 rounded-md hover:bg-gray-50 transition ease-in-out duration-150"
                  >
                    <svg
                      class="flex-shrink-0 w-6 h-6 text-indigo-600"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"
                      />
                    </svg>
                    <div class="text-base font-medium text-gray-900 leading-6">
                      Integrations
                    </div>
                  </a>
                  <a
                    href="#"
                    class="flex items-center p-3 -m-3 space-x-3 rounded-md hover:bg-gray-50 transition ease-in-out duration-150"
                  >
                    <svg
                      class="flex-shrink-0 w-6 h-6 text-indigo-600"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                      class="w-6 h-6"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                      />
                    </svg>
                    <div class="text-base font-medium text-gray-900 leading-6">
                      Automations
                    </div>
                  </a>
                </nav>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <main class="w-full">
      
<div class="pt-8 bg-center bg-cover lg:py-16">
  <div class="max-w-5xl mx-auto">
    <h1
      class="text-3xl font-extrabold tracking-tight text-center text-theme-dark dark:text-theme leading-8 sm:text-4xl sm:leading-10"
    >
      Develop &amp; Deploy Ghost with PM2
    </h1>
  </div>
</div>
<div class="flex">
  <div class="flex-1 mx-2">
    <ul>
      
      <li>
        <a href="http://127.0.0.1:1111/blog/develop-and-deploy-ghost-with-pm2/#setting-up">Setting Up</a>
        
        <ul class="pl-4">
          
          <li>
            <a href="http://127.0.0.1:1111/blog/develop-and-deploy-ghost-with-pm2/#project">Project</a>
          </li>
          
          <li>
            <a href="http://127.0.0.1:1111/blog/develop-and-deploy-ghost-with-pm2/#dependencies">Dependencies</a>
          </li>
          
        </ul>
        
      </li>
      
      <li>
        <a href="http://127.0.0.1:1111/blog/develop-and-deploy-ghost-with-pm2/#development">Development</a>
        
        <ul class="pl-4">
          
          <li>
            <a href="http://127.0.0.1:1111/blog/develop-and-deploy-ghost-with-pm2/#create-a-config-js-for-ghost">Create a config.js for Ghost</a>
          </li>
          
          <li>
            <a href="http://127.0.0.1:1111/blog/develop-and-deploy-ghost-with-pm2/#pass-configuration-into-ghost">Pass Configuration into Ghost</a>
          </li>
          
          <li>
            <a href="http://127.0.0.1:1111/blog/develop-and-deploy-ghost-with-pm2/#before-you-commit">Before You Commit</a>
          </li>
          
        </ul>
        
      </li>
      
      <li>
        <a href="http://127.0.0.1:1111/blog/develop-and-deploy-ghost-with-pm2/#setting-up-pm2-for-deployment">Setting up PM2 for Deployment</a>
        
        <ul class="pl-4">
          
          <li>
            <a href="http://127.0.0.1:1111/blog/develop-and-deploy-ghost-with-pm2/#create-an-ecosystem-json">Create an ecosystem.json</a>
          </li>
          
          <li>
            <a href="http://127.0.0.1:1111/blog/develop-and-deploy-ghost-with-pm2/#deploy-key">Deploy Key</a>
          </li>
          
          <li>
            <a href="http://127.0.0.1:1111/blog/develop-and-deploy-ghost-with-pm2/#deploying">Deploying</a>
          </li>
          
          <li>
            <a href="http://127.0.0.1:1111/blog/develop-and-deploy-ghost-with-pm2/#that-s-it">That&#x27;s It!</a>
          </li>
          
        </ul>
        
      </li>
      
    </ul>
  </div>
  <div class="flex-none mx-2">
    
    <show-after date="2015-05-01" class="block mb-4">
      <div
        class="p-4 shadow-lg rounded-md bg-gradient-to-tr from-yellow-500 to-yellow-400"
      >
        <div class="flex">
          <div class="flex-shrink-0">
            <svg
              class="w-5 h-5 text-white text-opacity-75"
              viewBox="0 0 20 20"
              fill="currentColor"
            >
              <path
                fill-rule="evenodd"
                d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                clip-rule="evenodd"
              />
            </svg>
          </div>
          <div class="flex-1 ml-3 md:flex md:justify-between">
            <p class="text-sm text-white leading-5 text-opacity-75">
              This post is over a year old. The information contained within may
              no longer be accurate.
            </p>
          </div>
        </div>
      </div>
    </show-after>
    
    <span
      class="text-base font-semibold tracking-wide text-orange-600 uppercase leading-6"
    >
      Published:
    </span>
    <time datetime="2015-05-01">
      May 01, 2015
    </time>
    <div class="mx-auto markdown">
      <!-- Introduction here -->
<span id="continue-reading"></span><h2 id="setting-up">Setting Up</h2>
<p>If you already have a git repository setup and a <code>package.json</code> you can skip to
<a href="http://127.0.0.1:1111/blog/develop-and-deploy-ghost-with-pm2/#dependencies">Dependencies</a>.</p>
<h3 id="project">Project</h3>
<p>Create a git repository for this project:</p>
<ul>
<li><code>git init &lt;project name&gt;</code></li>
<li><code>cd &lt;project name&gt;</code></li>
</ul>
<p>Then create your package.json the easy way:</p>
<ul>
<li><code>npm init</code></li>
</ul>
<h3 id="dependencies">Dependencies</h3>
<p>Install global dependencies like <a href="https://www.npmjs.com/package/grunt">Grunt</a>
and <a href="https://www.npmjs.com/package/pm2">PM2</a> and package dependencies like
<a href="https://www.npmjs.com/package/ghost">Ghost</a> and
<a href="https://docs.npmjs.com/cli/shrinkwrap">Shrinkwrap</a>:</p>
<ul>
<li><code>npm install -g grunt pm2</code></li>
<li><code>npm install ghost shrinkwrap --save</code></li>
</ul>
<p>Next, create the project's index file at the root of the project. This is the
entry point PM2/Node.js will use to start your app This can be whatever you
like and I'll use <code>index.js</code> for the rest of the post.</p>
<p>Add the following to <code>index.js</code> and save it.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#abb2bf;">// Start Ghost
var ghost = require(&#39;ghost&#39;);
ghost().then(function (ghostServer) {
    ghostServer.start();
});
</span></code></pre>
<p>With that you can now run Ghost:
<code>pm2 start index.js --name &quot;&lt;process name&gt;&quot;</code></p>
<p>Upon visiting http://localhost:2368 you should see the standard blog with the
standard Casper theme and the default &quot;Welcome to Ghost&quot; blog post.</p>
<p>Visit http://localhost:2368/ghost/ to setup your development blog. Be sure to
remember your username and password for the future. It doesn't need to be a
real email address or even a secure password at thispoint because you'll only
be accessing the backend from your local computer. If the page hangs quite some
time, just refresh and you should be prompted to log in.</p>
<p>That's it. You're all setup.</p>
<h2 id="development">Development</h2>
<p>If your Ghost server is still running, stop it with:</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#adb7c9;">pm2 stop &lt;app name&gt;
</span></code></pre>
<p>Up until now, Ghost has been using the <code>content</code> directory in
<code>node_modules/ghost/</code> to store application data, themes, images, and Ghost
apps. We'll need to define a new place to store all of these things so npm
doesn't overwrite on the next <code>npm install</code> or <code>npm update</code> command.</p>
<h3 id="create-a-config-js-for-ghost">Create a <code>config.js</code> for Ghost</h3>
<p>Before we can adjust and configuration values to tell Ghost where we expect the
<code>content</code> directory to be, as well as a host of other things, such as which
port to listen on and how to send emails, we need a configuration file and we
need to tell Ghost where it is.</p>
<p>Grab the example config from
<a href="https://github.com/TryGhost/Ghost/blob/d10ae70982ed8e99690402940eb2179b3ccade87/config.example.js">Github</a> or
copy it from <code>/node_modules/ghost/config.example.js</code>. Run <code>cp node_modules/ghost/config.example.js config.js</code> to copy the one npm grabbed for
you. Edit the new <code>config.js</code> to remove any testing related configs for the
Ghost core. This will prevent you from getting confused later on. You should be
left with a &quot;production&quot; object and a &quot;development&quot; object in the &quot;config&quot;
object in <code>config.js</code>.</p>
<p>Ghost expects the file and folder stucture from before to be in place wherever
we tell it the <code>content</code> directory is. Run <code>cp -R node_modules/ghost/content/ content/</code> to copy the entire content directory from <code>node_modules</code> to the root
of the project.</p>
<h3 id="pass-configuration-into-ghost">Pass Configuration into Ghost</h3>
<p>In <code>index.js</code> we're going to tell ghost to use the <code>config.js</code> file as it's
configuration file. We can pass the <code>ghost()</code> call an object to tell it which
configuration file to load: </p>
<pre style="background-color:#2b303b;">
<code><span style="color:#cd74e8;">var </span><span style="color:#adb7c9;">path = </span><span style="color:#5ebfcc;">require</span><span style="color:#abb2bf;">(</span><span style="color:#9acc76;">&#39;path&#39;</span><span style="color:#abb2bf;">),
    </span><span style="color:#adb7c9;">ghost = </span><span style="color:#5ebfcc;">require</span><span style="color:#abb2bf;">(</span><span style="color:#9acc76;">&#39;ghost&#39;</span><span style="color:#abb2bf;">);

</span><span style="color:#eb6772;">ghost</span><span style="color:#abb2bf;">({
  config: </span><span style="color:#adb7c9;">path</span><span style="color:#abb2bf;">.</span><span style="color:#eb6772;">join</span><span style="color:#abb2bf;">(__dirname, </span><span style="color:#9acc76;">&#39;config.js&#39;</span><span style="color:#abb2bf;">)
}).</span><span style="color:#eb6772;">then</span><span style="color:#abb2bf;">(</span><span style="color:#cd74e8;">function </span><span style="color:#abb2bf;">(</span><span style="color:#adb7c9;">ghostServer</span><span style="color:#abb2bf;">) {
  </span><span style="color:#adb7c9;">ghostServer</span><span style="color:#abb2bf;">.</span><span style="color:#eb6772;">start</span><span style="color:#abb2bf;">();
});

</span></code></pre>
<p><em>Don't forget to create and instance of the Node.js <code>path</code> object on line 1.</em></p>
<p>You can now create themes and apps as you normally would with Ghost. Just be
sure to edit files in the <code>content/</code> directory at the root of the project,
<strong>Not</strong> the one in <code>node_modules/ghost/</code>.</p>
<h3 id="before-you-commit">Before You Commit</h3>
<p>Before you commit changes it's probably a good idea to stop the PM2 process and
add <code>content/data/*.db</code> to your <code>.gitignore</code> since it's the folder SQLite uses
to store databases and they have the <code>.db</code> extention.</p>
<p>If you already commited the SQLite database you can still edit your
<code>.gitignore</code> and then run <code>git m -r --cached content/data/*db</code> to remove it
from git's index. Finally, commit the <code>.gitignore</code> and the &quot;deleted&quot; files from
git's index as usual.</p>
<h2 id="setting-up-pm2-for-deployment">Setting up PM2 for Deployment</h2>
<p>Since version 0.9.0, PM2 has been able to deploy code for you. To see the
commands availble for deployment run <code>pm2 deploy help</code>.</p>
<h3 id="create-an-ecosystem-json">Create an ecosystem.json</h3>
<p>To get started setting up PM2 for deployment let's have PM2 do some of the work
for us. While in your project root, run <code>pm2 ecosystem</code>.</p>
<p>For me, this generated an <code>ecosystem.json5</code> file in the project root.
<a href="http://json5.org">JSON5</a> is an extention to JSON that adds some additional
features to JSON like comments and unquoted keys. I'm not a fan of JSON5 for a
couple of reasons, this little warning doesn't help:</p>
<blockquote>
<p>JSON5 is not an official successor to JSON, and JSON5 content may not work
with existing JSON parsers. For this reason, JSON5 files use a new .json5
extension.</p>
</blockquote>
<ul>
<li><a href="http://json5.org">json5.org</a></li>
</ul>
<p>Later, when I tried to use thie file, PM2 was still looking for
<code>ecosystem.json</code> not <code>ecosystem.json5</code> so I decided to rename it to the former.
I'll suggest you do the same until I know differently.</p>
<p>Once the file has been generated, you'll want to edit it with your projects
configuration. Sine we rename the extention, we should make sure it's valid
JSON first.</p>
<p>Here's what my <code>ecosystem.json</code> looks like:</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#abb2bf;">{
  </span><span style="color:#9acc76;">&quot;apps&quot;</span><span style="color:#abb2bf;">: [{
		</span><span style="color:#9acc76;">&quot;name&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#9acc76;">&quot;&lt;project name&gt;&quot;</span><span style="color:#abb2bf;">,
		</span><span style="color:#9acc76;">&quot;script&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#9acc76;">&quot;index.js&quot;
  </span><span style="color:#abb2bf;">}]</span><span style="color:#adb7c9;">,

  </span><span style="color:#9acc76;">&quot;deploy&quot;</span><span style="color:#abb2bf;">: {
    </span><span style="color:#9acc76;">&quot;production&quot;</span><span style="color:#abb2bf;"> : {
      </span><span style="color:#9acc76;">&quot;user&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#9acc76;">&quot;&lt;user to run as on production&gt;&quot;</span><span style="color:#adb7c9;">,
      </span><span style="color:#9acc76;">&quot;host&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#9acc76;">&quot;&lt;production IP or domain&gt;&quot;</span><span style="color:#adb7c9;">,
      </span><span style="color:#9acc76;">&quot;ref&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#9acc76;">&quot;origin/&lt;production branch&gt;&quot;</span><span style="color:#adb7c9;">,
      </span><span style="color:#9acc76;">&quot;repo&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#9acc76;">&quot;git@github.com:&lt;Github username&gt;/&lt;project name&gt;.git&quot;</span><span style="color:#adb7c9;">,
      </span><span style="color:#9acc76;">&quot;path&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#9acc76;">&quot;/var/www/&lt;production directory&gt;&quot;</span><span style="color:#adb7c9;">,
      </span><span style="color:#9acc76;">&quot;post-deploy&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#9acc76;">&quot;npm install --production &amp;&amp; pm2 startOrRestart ecosystem.json --env production&quot;</span><span style="color:#adb7c9;">,
      </span><span style="color:#9acc76;">&quot;env&quot;</span><span style="color:#abb2bf;">: {
        </span><span style="color:#9acc76;">&quot;NODE_ENV&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#9acc76;">&quot;production&quot;
      </span><span style="color:#abb2bf;">}
    }</span><span style="color:#adb7c9;">,
    </span><span style="color:#9acc76;">&quot;staging&quot;</span><span style="color:#abb2bf;">: {
      </span><span style="color:#9acc76;">&quot;user&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#9acc76;">&quot;&lt;user to run as on stage&gt;&quot;</span><span style="color:#adb7c9;">,
      </span><span style="color:#9acc76;">&quot;host&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#9acc76;">&quot;&lt;staging IP or domain&gt;&quot;</span><span style="color:#adb7c9;">,
      </span><span style="color:#9acc76;">&quot;ref&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#9acc76;">&quot;origin/&lt;staging branch&gt;&quot;</span><span style="color:#adb7c9;">,
      </span><span style="color:#9acc76;">&quot;repo&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#9acc76;">&quot;git@github.com:&lt;github username&gt;/&lt;project name&gt;.git&quot;</span><span style="color:#adb7c9;">,
      </span><span style="color:#9acc76;">&quot;path&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#9acc76;">&quot;/var/www/&lt;staging directory&gt;&quot;</span><span style="color:#adb7c9;">,
      </span><span style="color:#9acc76;">&quot;post-deploy&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#9acc76;">&quot;npm install --production &amp;&amp; pm2 startOrRestart ecosystem.json --env staging&quot;</span><span style="color:#adb7c9;">,
      </span><span style="color:#9acc76;">&quot;env&quot;</span><span style="color:#abb2bf;">: {
        </span><span style="color:#9acc76;">&quot;NODE_ENV&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#9acc76;">&quot;staging&quot;
      </span><span style="color:#abb2bf;">}
    }
  }
}
</span></code></pre>
<p>In the above config, &quot;script&quot; under &quot;apps&quot; array refers to the entry-point
script you made above. I've been calling it <code>index.js</code> in this post. I for my
<code>staging</code> config I tell PM2 to set my <code>NODE_ENV</code> variable to be set to
&quot;staging&quot; because in my config.js I have a &quot;staging&quot; key. Ghost will load the
config key of the same name as the value of <code>NODE_ENV</code>.</p>
<h3 id="deploy-key">Deploy Key</h3>
<p>If your server is new you may not have setup public/private keypair
authentication. Follow the instructions <a href="https://docs.github.com/en/github/authenticating-to-github/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent">Github
provides</a>.
You'll then want to add this key as a deploy key for your project on Github.
This will allow PM2 to authenticate with Github to clone the repo.</p>
<p>While you are also connected to the server you should install PM2 using npm,
just as you did before locally (<code>npm install -g pm2</code>).</p>
<h3 id="deploying">Deploying</h3>
<p>Be sure that Github is in the server's <code>known_hosts</code> file or you'll get cloning
errors. This can be done by running <code>ssh git@github.com</code> on the server and
accepting the prompt to add it to the file.</p>
<p>We need to have PM2 setup the server for deployment. Run <code>pm2 deploy &lt;ecosystem.json config key&gt; setup</code> from your local machine. For example, to
setup my &quot;staging&quot; config above I would run <code>pm2 deploy staging setup</code>. I would
expect to see something like this:</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#eb6772;">$</span><span style="color:#abb2bf;"> pm2 deploy staging setup
</span><span style="color:#eb6772;">--</span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;"> Deploying to staging environment
</span><span style="color:#eb6772;">--</span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;"> on host </span><span style="color:#adb7c9;">&lt;</span><span style="color:#abb2bf;">staging IP or domain</span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;">
  ○ running setup
  </span><span style="color:#eb6772;">○</span><span style="color:#abb2bf;"> cloning git@github.com:alecho/</span><span style="color:#adb7c9;">&lt;</span><span style="color:#abb2bf;">project name</span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;">.git
</span><span style="color:#eb6772;">Cloning</span><span style="color:#abb2bf;"> into </span><span style="color:#9acc76;">&#39;/var/www/&lt;staging directory&gt;/source&#39;</span><span style="color:#abb2bf;">...
</span><span style="color:#eb6772;">Warning:</span><span style="color:#abb2bf;"> Permanently added the RSA host key for IP address </span><span style="color:#9acc76;">&#39;**Github&#39;</span><span style="color:#abb2bf;">s IP here</span><span style="color:#adb7c9;">**</span><span style="color:#9acc76;">&#39; to the list of known hosts.
  ○ setup complete
--&gt; Success
</span></code></pre>
<p>Once PM2 is done setting up the server run <code>pm2 deploy &lt;ecosystem.json config key&gt;</code>. Just like above, this would be <code>pm2 deploy staging</code> for my staging
environment and should output something like:</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#eb6772;">$</span><span style="color:#abb2bf;"> pm2 deploy staging
</span><span style="color:#eb6772;">--</span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;"> Deploying to staging environment
</span><span style="color:#eb6772;">--</span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;"> on host </span><span style="color:#adb7c9;">&lt;</span><span style="color:#abb2bf;">staging IP or </span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;">
  ○ deploying
  </span><span style="color:#eb6772;">○</span><span style="color:#abb2bf;"> hook pre-deploy
  </span><span style="color:#eb6772;">○</span><span style="color:#abb2bf;"> fetching updates
</span><span style="color:#eb6772;">Fetching</span><span style="color:#abb2bf;"> origin
</span><span style="color:#eb6772;">Warning:</span><span style="color:#abb2bf;"> Permanently added the RSA host key for IP address </span><span style="color:#9acc76;">&#39;**Github&#39;</span><span style="color:#abb2bf;">s IP here</span><span style="color:#adb7c9;">**</span><span style="color:#9acc76;">&#39; to the list of known hosts.
  ○ resetting HEAD to origin/staging
HEAD is now at &lt;git hash for latest commit on origin/staging&gt; &lt;commit message here&gt;
  ○ executing post-deploy `npm install &amp;&amp; pm2 startOrRestart ecosystem.json --env staging`

** npm install output here **
</span></code></pre>
<p>You shoudl then see the typical output of <code>pm2 list</code> with the Ghost blog
process running followed by:</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#abb2bf;"> Use `pm2 show &lt;id|name&gt;` to get more details about an app
  ○ hook test
  ○ successfully deployed origin/staging
--&gt; Success
</span></code></pre><h3 id="that-s-it">That's It!</h3>
<p>You're now able to deploy your latest changes to staging and production
environments with ease. There's no reason you couldn't setup a deveopment
enviroment with PM2 as well but I find that Ghost is easy enough to just
&quot;clone&quot;, &quot;install&quot;, and &quot;start&quot; that I haven't yet.</p>
<p>If you run into issues or know of a better way of doing things let me know in
the comments.</p>

    </div>
  </div>
  <div class="flex-1 mx-2"></div>
</div>

    </main>
    <footer class="bg-theme-light dark:bg-theme-dark">
      <div class="px-4 py-12 mx-auto overflow-hidden max-w-7xl sm:px-6 lg:px-8">
        <nav class="flex flex-wrap justify-center -mx-5 -my-2" aria-label="Footer">
          <div class="px-5 py-2">
            <a href="#" class="text-base text-gray-500 hover:text-gray-900">
              About
            </a>
          </div>

          <div class="px-5 py-2">
            <a href="#" class="text-base text-gray-500 hover:text-gray-900">
              Blog
            </a>
          </div>

          <div class="px-5 py-2">
            <a href="#" class="text-base text-gray-500 hover:text-gray-900">
              Jobs
            </a>
          </div>

          <div class="px-5 py-2">
            <a href="#" class="text-base text-gray-500 hover:text-gray-900">
              Press
            </a>
          </div>

          <div class="px-5 py-2">
            <a href="#" class="text-base text-gray-500 hover:text-gray-900">
              Accessibility
            </a>
          </div>

          <div class="px-5 py-2">
            <a href="#" class="text-base text-gray-500 hover:text-gray-900">
              Partners
            </a>
          </div>
          
          <div class="px-5 py-2">
            <a href="/tags/" class="text-base text-gray-500 hover:text-gray-900">tags</a>
          </div>
          
          <div class="px-5 py-2">
            <a href="/categories/" class="text-base text-gray-500 hover:text-gray-900">categories</a>
          </div>
          
        </nav>
        <div class="flex justify-center mt-8 space-x-6">
          <a href="#" class="text-gray-400 hover:text-gray-500">
            <span class="sr-only">GitHub</span>
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd" />
            </svg>
          </a>
        </div>
        <p class="mt-8 text-base text-center text-gray-400">
          &copy; 2020 Andrew Lechowicz. All rights reserved.
        </p>
      </div>
    </footer>

  <script src="/livereload.js?port=1024&amp;mindelay=10"></script></body>
</html>
